<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MonoBol - Get Help</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Apply font stack (Inter for English, Hind Siliguri for Bangla) */
        body {
            font-family: 'Inter', 'Hind Siliguri', sans-serif;
        }
        
        /* Custom animation for pulsing button */
        @keyframes pulse-animation {
          /* Use Tailwind's red-500 color for consistency */
          0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 
          70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 
          100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .pulse {
          animation: pulse-animation 2s infinite;
        }
    </style>
    
    <script>
        // Custom Tailwind configuration
        tailwind.config = {
            darkMode: 'class', 
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Hind Siliguri', 'sans-serif'],
                    },
                    colors: {
                        'brand-blue': {
                            'light': '#00BFFF',
                            'DEFAULT': '#00A2E8',
                            'dark': '#0077B6'
                        },
                        'brand-cyan': '#06b6d4',
                        'brand-cyan-hover': '#0891b2'
                    }
                }
            }
        }
    </script>

    <script>
        // Theme initialization script
        if (localStorage.getItem('theme') === 'dark' || 
           (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
    </script>
</head>

<body class="bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-200">

    <header class="w-full border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 sticky top-0 z-50">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-5">
            <div class="flex justify-between items-center">
                <div class="flex-shrink-0">
                    <a href="../index.html" class="text-2xl font-bold text-gray-900 dark:text-white" data-i18n-key="logo">MonoBol</a>
                </div>

                <div class="hidden md:flex flex-1 justify-center space-x-8">
                    <a href="Mood_Tracker.html" class="text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white font-medium" data-i18n-key="navMood">Mood Tracker</a>
                    <a href="get_help.html" class="text-brand-cyan-hover font-semibold border-b-2 border-brand-cyan-hover" data-i18n-key="navGetHelp">Get Help</a>
                    <a href="Seasonal_Health_Tips.html" class="text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white font-medium" data-i18n-key="navHealthTips">Health Tips</a>
                    <a href="Symptoms.html" class="text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white font-medium" data-i18n-key="navSymptoms">Symptoms</a>
                    <a href="Health_event.html" class="text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white font-medium" data-i18n-key="navEvents">Health Events</a>
                </div>

                <div class="hidden md:flex items-center space-x-4">
                    <button id="lang-toggle-btn" type="button" class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white font-medium w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        বাংলা
                    </button>

                    <button id="theme-toggle-btn" type="button" class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        <svg id="theme-icon-sun" class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                        <svg id="theme-icon-moon" class="h-5 w-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                    </button>

                    <a href="#" class="text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white font-medium" data-i18n-key="navLogin">Log In</a>
                    <a href="#" class="bg-brand-cyan hover:bg-brand-cyan-hover text-white font-medium py-2 px-5 rounded-lg transition duration-200" data-i18n-key="navGetStarted">
                        Get started
                    </a>
                </div>
                
                <div class="md:hidden flex items-center space-x-2">
                    <button id="lang-toggle-btn-mobile" type="button" class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white font-medium w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        বাংলা
                    </button>
                    <button id="theme-toggle-btn-mobile" type="button" class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        <svg id="theme-icon-sun-mobile" class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                        <svg id="theme-icon-moon-mobile" class="h-5 w-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                    </button>
                    <button type="button" id="mobile-menu-button" class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white focus:outline-none w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </nav>
        
        <div id="mobile-menu-panel" class="hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="Mood_Tracker.html" class="text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 block px-3 py-2 rounded-md font-medium" data-i18n-key="navMood">Mood Tracker</a>
                <a href="get_help.html" class="text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white font-medium" data-i18n-key="navGetHelp">Get Help</a>
                <a href="Seasonal_Health_Tips.html" class="text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 block px-3 py-2 rounded-md font-medium" data-i18n-key="navHealthTips">Health Tips</a>
                <a href="Symptoms.html" class="text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 block px-3 py-2 rounded-md font-medium" data-i18n-key="navSymptoms">Symptoms</a>
                <a href="Health_event.html" class="text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 block px-3 py-2 rounded-md font-medium" data-i18n-key="navEvents">Health Events</a>
            </div>
            <div class="border-t border-gray-200 dark:border-gray-700 pt-4 pb-3 px-2">
                   <a href="#" class="block w-full text-center bg-brand-cyan hover:bg-brand-cyan-hover text-white font-medium py-2 px-3 rounded-lg transition duration-200" data-i18n-key="navGetStarted">
                        Get started
                   </a>
                <a href="#" class="mt-2 block w-full text-center text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 font-medium py-2 px-3 rounded-lg" data-i18n-key="navLogin">
                    Log In
                </a>
            </div>
        </div>
    </header>

    <main class="py-16 sm:py-24 px-4">
        
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-lg mx-auto flex flex-col" style="height: 70vh; min-height: 550px; overflow: hidden;">

            <header class="p-4 border-b border-gray-200 dark:border-gray-700 bg-brand-cyan text-white">
                <h1 class="text-2xl font-bold text-center" data-i18n-key="chatTitle">স্বাস্থ্য পরামর্শক এআই</h1>
            </header>

            <div class="p-3 bg-yellow-100 text-yellow-800 text-xs text-center border-b border-yellow-200 dark:border-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-200">
                <p>
                    <strong data-i18n-key="chatDisclaimerTitle">গুরুত্বপূর্ণ:</strong> 
                    <span data-i18n-key="chatDisclaimerText">এটি শুধুমাত্র প্রাথমিক পরামর্শের জন্য। রোগ নির্ণয় বা চিকিৎসার জন্য অবশ্যই একজন প্রকৃত ডাক্তারের সাথে পরামর্শ নিন।</span>
                </p>
            </div>

            <div id="chat-history" class="chat-container flex-grow p-4 space-y-4 overflow-y-auto">
                <div class="flex justify-start">
                    <div class="p-3 max-w-xs md:max-w-md shadow-md bg-gray-200 dark:bg-gray-700 rounded-lg rounded-bl-none">
                        <span data-i18n-key="chatInitialBotMsg">আমি আপনার স্বাস্থ্য পরামর্শক এআই। আপনি কেমন বোধ করছেন বা আপনার কী সমস্যা হচ্ছে, বাংলায় বলুন। আমি আপনাকে সাধারণ স্বাস্থ্য জ্ঞান দিয়ে সাহায্য করতে পারি।</span>
                    </div>
                </div>
            </div>

            <footer class="p-4 border-t border-gray-200 dark:border-gray-700 flex flex-col items-center space-y-3">
                
                <div id="status-message" class="text-sm font-medium text-gray-600 dark:text-gray-300 h-5" data-i18n-key="chatStatusReady">
                    রেকর্ডিং শুরু করতে মাইক বোতামটি চাপুন
                </div>

                <button id="voice-button" 
                    class="voice-btn w-20 h-20 rounded-full flex items-center justify-center text-white text-3xl transition-colors duration-200 bg-brand-cyan hover:bg-brand-cyan-hover disabled:bg-gray-400"
                    onclick="handleStartRecording()"
                    disabled>
                    <svg id="mic-icon-mic" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8">
                        <path d="M8.25 4.5a.75.75 0 01.75.75v13.5a.75.75 0 01-1.5 0V5.25a.75.75 0 01.75-.75zM15.75 4.5a.75.75 0 01.75.75v13.5a.75.75 0 01-1.5 0V5.25a.75.75 0 01.75-.75z" />
                        <path fill-rule="evenodd" d="M12 1.5a4.5 4.5 0 00-4.5 4.5v9a4.5 4.5 0 009 0v-9A4.5 4.5 0 0012 1.5zm0 18a1.5 1.5 0 001.5-1.5v-2.25a.75.75 0 011.5 0V18a3 3 0 01-6 0v-2.25a.75.75 0 011.5 0v2.25a1.5 1.5 0 001.5 1.5z" clip-rule="evenodd" />
                    </svg>
                    <svg id="mic-icon-stop" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8 hidden">
                        <path fill-rule="evenodd" d="M4.5 7.5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-9a3 3 0 01-3-3v-9z" clip-rule="evenodd" />
                    </svg>
                </button>
                <p id="error-message" class="text-red-500 text-sm h-4"></p>
            </footer>

        </div>
    </main>
    
    <footer class="bg-gray-800 text-gray-300">
        <div class="max-w-7xl mx-auto py-16 px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12">
                
                <div class="md:col-span-1">
                    <a href="../index.html" class="text-2xl font-bold text-white" data-i18n-key="logo">MonoBol</a>
                    <p class="text-gray-400 text-sm mt-3" data-i18n-key="footerSlogan">
                        Delivering safe and compassionate care for community well-being.
                    </p>
                    <div class="flex space-x-5 mt-6">
                        <a href="#" class="text-gray-400 hover:text-brand-cyan transition-colors" aria-label="Facebook">
                            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.772-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" clip-rule="evenodd" /></svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-brand-cyan transition-colors" aria-label="Twitter">
                            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84" /></svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-brand-cyan transition-colors" aria-label="LinkedIn">
                            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" clip-rule="evenodd" /></svg>
                        </a>
                    </div>
                </div>

                <div>
                    <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider" data-i18n-key="footerFeatures">Features</h3>
                    <ul class="mt-4 space-y-3">
                        <li><a href="Mood_Tracker.html" class="text-base hover:text-white transition-colors" data-i18n-key="navMood">Mood Tracker</a></li>
                        <li><a href="#" class="text-base hover:text-white transition-colors" data-i18n-key="footerNearby">Nearby Healthcare</a></li>
                        <li><a href="get_help.html" class="text-base hover:text-white transition-colors" data-i18n-key="navGetHelp">Get Help</a></li>
                    </ul>
                </div>

                <div>
                    <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider" data-i18n-key="footerResources">Resources</h3>
                    <ul class="mt-4 space-y-3">
                        <li><a href="Seasonal_Health_Tips.html" class="text-base hover:text-white transition-colors" data-i18n-key="navHealthTips">Health Tips</a></li>
                        <li><a href="Health_event.html" class="text-base hover:text-white transition-colors" data-i18n-key="navEvents">Health Events</a></li>
                        <li><a href="Symptoms.html" class="text-base hover:text-white transition-colors" data-i18n-key="navSymptoms">Symptoms</a></li>
                    </ul>
                </div>

                <div>
                    <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider" data-i18n-key="footerCompany">Company</h3>
                    <ul class="mt-4 space-y-3">
                        <li><a href="#" class="text-base hover:text-white transition-colors" data-i18n-key="footerAbout">About Us</a></li>
                        <li><a href="#" class="text-base hover:text-white transition-colors" data-i18n-key="footerContact">Contact</a></li>
                        <li><a href="#" class="text-base hover:text-white transition-colors" data-i18n-key="footerPrivacy">Privacy Policy</a></li>
                        <li><a href="#" class="text-base hover:text-white transition-colors" data-i18n-key="footerTerms">Terms of Service</a></li>
                    </ul>
                </div>

            </div>

            <div class="mt-12 border-t border-gray-700 pt-8">
              <p class="text-sm text-gray-500 text-center mb-4">
                    <strong data-i18n-key="footerDisclaimerTitle">Medical Disclaimer:</strong> <span data-i18n-key="footerDisclaimerText">The information on this site is not a substitute for professional medical advice, diagnosis, or treatment. Always seek the advice of your physician or other qualified health provider.</span>
                </p>
                <p class="text-base text-gray-500 text-center" data-i18n-key="footerCopyright">
                    &copy; 2025 MonoBol & ShunnoLogic. All rights reserved.
                </p>
            </div>
        </div>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- 1. ALL DOM ELEMENT SELECTIONS ---
            
            // Header selections
            const langToggleBtn = document.getElementById('lang-toggle-btn');
            const langToggleBtnMobile = document.getElementById('lang-toggle-btn-mobile');
            const themeToggleBtn = document.getElementById('theme-toggle-btn');
            const themeToggleBtnMobile = document.getElementById('theme-toggle-btn-mobile');
            const sunIcons = [document.getElementById('theme-icon-sun'), document.getElementById('theme-icon-sun-mobile')];
            const moonIcons = [document.getElementById('theme-icon-moon'), document.getElementById('theme-icon-moon-mobile')];
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenuPanel = document.getElementById('mobile-menu-panel');

            // Chat app selections
            const chatHistory = document.getElementById('chat-history');
            const voiceButton = document.getElementById('voice-button');
            const micIconMic = document.getElementById('mic-icon-mic');
            const micIconStop = document.getElementById('mic-icon-stop');
            const statusMessage = document.getElementById('status-message');
            const errorMessage = document.getElementById('error-message');


            // --- 2. TRANSLATION (i18n) LOGIC & DICTIONARY ---
            
            const translations = {
                'en': {
                    // Nav/Footer
                    'logo': 'MonoBol',
                    'langToggle': 'বাংলা', 
                    'navMood': 'Mood Tracker',
                    'navGetHelp': 'Get Help',
                    'navHealthTips': 'Health Tips',
                    'navSymptoms': 'Symptoms',
                    'navEvents': 'Health Events',
                    'navLogin': 'Log In',
                    'navGetStarted': 'Get started',
                    'footerSlogan': 'Delivering safe and compassionate care for community well-being.',
                    'footerFeatures': 'Features',
                    'footerNearby': 'Nearby Healthcare',
                    'footerResources': 'Resources',
                    'footerCompany': 'Company',
                    'footerAbout': 'About Us',
                    'footerContact': 'Contact',
                    'footerPrivacy': 'Privacy Policy',
                    'footerTerms': 'Terms of Service',
                    'footerDisclaimerTitle': 'Medical Disclaimer:',
                    'footerDisclaimerText': 'The information on this site is not a substitute for professional medical advice, diagnosis, or treatment. Always seek the advice of your physician or other qualified health provider.',
                    'footerCopyright': '© 2025 MonoBol & ShunnoLogic. All rights reserved.',
                    
                    // Chat App Static Text
                    'chatTitle': 'Health Consultant AI',
                    'chatDisclaimerTitle': 'Important:',
                    'chatDisclaimerText': 'This is for preliminary advice only. You must consult a real doctor for diagnosis or treatment.',
                    'chatInitialBotMsg': 'I am your AI health consultant. Tell me how you are feeling or what your problem is. I can help you with general health knowledge.',
                    
                    // Chat App Dynamic Text
                    'chatStatusReady': 'Press the mic button to start recording',
                    'chatStatusListening': 'Recording... speak now',
                    'chatStatusProcessing': 'Analyzing...',
                    'chatStatusGenerating': 'AI is generating a response...',
                    'chatStatusSpeaking': 'AI is speaking...',
                    'chatStatusDone': 'Recording finished. Generating response...',
                    'chatStatusStopped': 'Recording stopped.',
                    'chatErrorNoBrowserSupport': 'Sorry, your browser does not support speech recognition.',
                    'chatErrorVoiceInput': 'Voice input error: ',
                    'chatErrorNetwork': 'Network problem',
                    'chatErrorOther': 'Other error',
                    'chatErrorNoApiKey': 'API Key is missing. Please add your Gemini API Key.',
                    'chatErrorNoResponse': 'No response received from AI.',
                    'chatErrorSendFailed': 'Failed to send message: ',
                    'chatErrorAudioPlayback': 'There was a problem playing the audio.',
                    'chatErrorTtsFailed': 'Problem speaking: ',
                    'chatErrorTtsFormat': 'Audio file not found or format is incorrect.',
                    'chatErrorRecognitionStart': 'There was a problem starting the recording.'
                },
                // *** BEGIN BN-IN FIX: Updated all translations to Indian Bengali dialect ***
                'bn': {
                    // Nav/Footer
                    'logo': 'মনোবল', // Spelling changed
                    'langToggle': 'EN', 
                    'navMood': 'মুড ট্র্যাকার',
                    'navGetHelp': 'সাহায্য নিন',
                    'navHealthTips': 'স্বাস্থ্য টিপস',
                    'navSymptoms': 'লক্ষণ',
                    'navEvents': 'স্বাস্থ্য ইভেন্ট',
                    'navLogin': 'লগ ইন',
                    'navGetStarted': 'শুরু করুন',
                    'footerSlogan': 'সম্প্রদায়ের মঙ্গলের জন্য নিরাপদ এবং সহানুভূতিশীল যত্ন প্রদান।', // Phrasing tweaked
                    'footerFeatures': 'বৈশিষ্ট্য',
                    'footerNearby': 'কাছাকাছি স্বাস্থ্যসেবা',
                    'footerResources': 'সম্পদ',
                    'footerCompany': 'প্রতিষ্ঠান',
                    'footerAbout': 'আমাদের সম্পর্কে',
                    'footerContact': 'যোগাযোগ',
                    'footerPrivacy': 'গোপনীয়তা নীতি',
                    'footerTerms': 'পরিষেবার শর্তাবলী',
                    'footerDisclaimerTitle': 'চিকিৎসা সংক্রান্ত দাবিত্যাগ:', // Changed to "Medical Disclaimer"
                    'footerDisclaimerText': 'এই সাইটের তথ্য পেশাদারী চিকিৎসা পরামর্শ, রোগ নির্ণয় বা চিকিৎসার বিকল্প নয়। সর্বদা আপনার চিকিৎসক বা অন্যান্য যোগ্য স্বাস্থ্য প্রদানকারীর পরামর্শ নিন।', // "পেশাদারী" and " চিকিৎসক"
                    'footerCopyright': '© ২০২৫ মনোবল ও শূন্যলজিক। সর্বস্বত্ব সংরক্ষিত।', // Spelling changed

                    // Chat App Static Text
                    'chatTitle': 'স্বাস্থ্য পরামর্শদাতা এআই', // "পরামর্শক" -> "পরামর্শদাতা"
                    'chatDisclaimerTitle': 'গুরুত্বপূর্ণ:',
                    'chatDisclaimerText': 'এটি শুধুমাত্র প্রাথমিক পরামর্শের জন্য। রোগ নির্ণয় বা চিকিৎসার জন্য অবশ্যই একজন প্রকৃত ডাক্তারের পরামর্শ নিন।', // Tweaked
                    'chatInitialBotMsg': 'আমি আপনার স্বাস্থ্য পরামর্শদাতা এআই। আপনি কেমন বোধ করছেন বা আপনার কী সমস্যা হচ্ছে, বাংলায় বলুন। আমি আপনাকে সাধারণ স্বাস্থ্য জ্ঞান দিয়ে সাহায্য করতে পারি।', // "পরামর্শদাতা", "দিয়ে"

                    // Chat App Dynamic Text
                    'chatStatusReady': 'রেকর্ডিং শুরু করতে মাইক বোতামটি টিপুন', // "চাপুন" -> "টিপুন"
                    'chatStatusListening': 'রেকর্ডিং চলছে... কথা বলুন', // "হচ্ছে" -> "চলছে"
                    'chatStatusProcessing': 'বিশ্লেষণ করা হচ্ছে...',
                    'chatStatusGenerating': 'এআই উত্তর তৈরি করছে...',
                    'chatStatusSpeaking': 'এআই কথা বলছে...',
                    'chatStatusDone': 'রেকর্ডিং শেষ। উত্তর তৈরি হচ্ছে...',
                    'chatStatusStopped': 'রেকর্ডিং বন্ধ করা হয়েছে।', // Spelling
                    'chatErrorNoBrowserSupport': 'দুঃখিত, আপনার ব্রাউজার স্পিচ রিকগনিশন সাপোর্ট করে না।', // "সমর্থন করে না" -> "সাপোর্ট করে না"
                    'chatErrorVoiceInput': 'ভয়েস ইনপুট ত্রুটি: ',
                    'chatErrorNetwork': 'নেটওয়ার্ক সমস্যা',
                    'chatErrorOther': 'অন্যান্য ত্রুটি',
                    'chatErrorNoApiKey': 'API Key নেই। অনুগ্রহ করে আপনার Gemini API Key যোগ করুন।',
                    'chatErrorNoResponse': 'এআই-এর থেকে কোনো উত্তর পাওয়া যায়নি।', // Phrasing
                    'chatErrorSendFailed': 'বার্তা পাঠাতে ব্যর্থ: ',
                    'chatErrorAudioPlayback': 'অডিও চালাতে সমস্যা হচ্ছে।', // "হয়েছে" -> "হচ্ছে"
                    'chatErrorTtsFailed': 'কথা বলতে সমস্যা: ',
                    'chatErrorTtsFormat': 'অডিও ফাইল পাওয়া যায়নি বা ফাইলের ফরম্যাট ভুল।', // Spelling
                    'chatErrorRecognitionStart': 'রেকর্ডিং শুরু করতে সমস্যা হচ্ছে।' // "হয়েছে" -> "হচ্ছে"
                }
                // *** END BN-IN FIX ***
            };

            function getTranslation(key) {
                const lang = localStorage.getItem('language') || 'en';
                return translations[lang][key] || key; // Fallback to the key itself
            }

            function setLanguage(lang) {
                document.documentElement.lang = lang;
                localStorage.setItem('language', lang);

                const toggleText = translations[lang]['langToggle'];
                if (langToggleBtn) langToggleBtn.textContent = toggleText;
                if (langToggleBtnMobile) langToggleBtnMobile.textContent = toggleText;

                document.querySelectorAll('[data-i18n-key]').forEach(element => {
                    const key = element.getAttribute('data-i18n-key');
                    const translation = translations[lang][key];
                    if (translation) {
                        element.innerText = translation;
                    }
                });

                if (recognition) {
                    // *** BEGIN BN-IN FIX ***
                    // Use 'bn-IN' (Indian Bengali) for speech recognition
                    recognition.lang = lang === 'bn' ? 'bn-IN' : 'en-US';
                    // *** END BN-IN FIX ***
                }
                
                systemPrompt = lang === 'bn' ? systemPromptBengali : systemPromptEnglish;
            }

            function toggleLanguage() {
                const currentLang = localStorage.getItem('language') || 'en';
                const newLang = currentLang === 'en' ? 'bn' : 'en';
                setLanguage(newLang);
            }

            // --- 3. THEME (Dark/Light Mode) LOGIC ---

            function updateIcons(theme) {
                if (theme === 'dark') {
                    sunIcons.forEach(icon => icon && icon.classList.add('hidden'));
                    moonIcons.forEach(icon => icon && icon.classList.remove('hidden'));
                } else {
                    sunIcons.forEach(icon => icon && icon.classList.remove('hidden'));
                    moonIcons.forEach(icon => icon && icon.classList.add('hidden'));
                }
            }

            function toggleTheme() {
                const currentTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

                if (newTheme === 'dark') {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                localStorage.setItem('theme', newTheme);
                updateIcons(newTheme);
            }

            // --- 4. MOBILE MENU LOGIC ---
            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', () => {
                    if (mobileMenuPanel) mobileMenuPanel.classList.toggle('hidden');
                });
            }

            // --- 5. CHAT APP LOGIC ---

            const apiKey = "AIzaSyAx1GO5PmXZQDMr98CieMjuyaEyzwQIF44"; // Your provided API key
            const chatApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;

            let isListening = false;
            let isSpeaking = false; 
            let recognition = null;
            
            // *** BEGIN BN-IN FIX: Updated System Prompt to Indian Bengali ***
            const systemPromptBengali = "আপনি একজন সহানুভূতিশীল এবং তথ্যপূর্ণ স্বাস্থ্য পরামর্শদাতা এআই। আপনি কোনোভাবেই ডাক্তারের বিকল্প নন, এবং আপনি রোগ নির্ণয় বা নির্দিষ্ট চিকিৎসার প্রেসক্রিপশন দিতে পারবেন না। আপনার কাজ হলো ব্যবহারকারীর স্বাস্থ্য সংক্রান্ত জিজ্ঞাসাগুলি শোনা এবং সাধারণ স্বাস্থ্য জ্ঞান, প্রাথমিক পরিচর্যার পরামর্শ, এবং কখন একজন প্রকৃত ডাক্তারের পরামর্শ নেওয়া উচিত সেই বিষয়ে পথনির্দেশ করা। সমস্ত উত্তর অবশ্যই শুধুমাত্র বাংলাতেই দিতে হবে।";
            // *** END BN-IN FIX ***
            
            const systemPromptEnglish = "You are a compassionate and informative health consultant AI. You are not a substitute for a doctor, and you cannot provide a diagnosis or prescribe specific treatments. Your job is to listen to the user's health queries and provide general health knowledge, first-aid advice, and guidance on when to consult a real doctor. All responses must be in English.";
            
            let systemPrompt = systemPromptBengali; 

            const exponentialBackoffFetch = async (url, options, retries = 3, delay = 1000) => {
                for (let i = 0; i < retries; i++) {
                    try {
                        const response = await fetch(url, options);
                        if (response.status === 429 && i < retries - 1) {
                            await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
                            continue;
                        }
                        if (!response.ok) {
                            const errorBody = await response.text();
                            throw new Error(`API call failed: ${response.status} ${response.statusText}. Body: ${errorBody}`);
                        }
                        return response;
                    } catch (error) {
                        if (i === retries - 1) {
                            throw error;
                        }
                        await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
                    }
                }
            };

            // --- UI Update Functions ---
            const appendMessage = (role, text) => {
                const isUser = role === 'user';
                const messageDiv = document.createElement('div');
                messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'}`;
                
                const initialBotMsgEl = chatHistory.querySelector('[data-i18n-key="chatInitialBotMsg"]');
                if (initialBotMsgEl) {
                    initialBotMsgEl.parentElement.parentElement.remove();
                }
                
                messageDiv.innerHTML = `
                    <div class="p-3 max-w-xs md:max-w-md rounded-lg shadow-md ${isUser ? 'bg-brand-cyan text-white rounded-br-none' : 'bg-gray-200 dark:bg-gray-700 rounded-bl-none'}">
                        ${text.replace(/\n/g, '<br>')}
                    </div>
                `;
                chatHistory.appendChild(messageDiv);
                chatHistory.scrollTop = chatHistory.scrollHeight;
            };

            const updateButtonState = (listening, speaking, statusKey) => {
                isListening = listening;
                isSpeaking = false; // Always false as TTS is removed

                if (voiceButton) {
                    voiceButton.disabled = listening || speaking; 
                    voiceButton.classList.toggle('pulse', listening);
                    voiceButton.classList.toggle('bg-red-500', listening);
                    voiceButton.classList.toggle('hover:bg-red-600', listening);
                    voiceButton.classList.toggle('bg-brand-cyan', !listening);
                    voiceButton.classList.toggle('hover:bg-brand-cyan-hover', !listening);
                }
                
                // Toggle between mic and stop icons
                if (micIconMic && micIconStop) {
                    micIconMic.classList.toggle('hidden', listening);
                    micIconStop.classList.toggle('hidden', !listening);
                }
                
                if (statusMessage) {
                    statusMessage.textContent = getTranslation(statusKey);
                }
            };
            
            const displayError = (messageKey, details = "") => {
                if (errorMessage) {
                    errorMessage.textContent = getTranslation(messageKey) + details;
                    setTimeout(() => errorMessage.textContent = '', 5000);
                }
            };

            // --- Core Logic ---
            const setupVoiceRecognition = () => {
                if (!('webkitSpeechRecognition' in window)) {
                    displayError("chatErrorNoBrowserSupport");
                    if (voiceButton) voiceButton.disabled = true;
                    return;
                }

                recognition = new webkitSpeechRecognition();
                
                // *** BEGIN BN-IN FIX ***
                // Use 'bn-IN' (Indian Bengali) for speech recognition
                recognition.lang = localStorage.getItem('language') === 'bn' ? 'bn-IN' : 'en-US'; 
                // *** END BN-IN FIX ***
                
                recognition.continuous = false; 
                recognition.interimResults = false;
                
                recognition.onstart = () => {
                    updateButtonState(true, false, "chatStatusListening");
                };

                recognition.onresult = (event) => {
                    let transcript = event.results[0][0].transcript;
                    recognition.stop();
                    updateButtonState(false, true, "chatStatusProcessing"); 
                    sendMessage(transcript);
                };

                recognition.onerror = (event) => {
                    recognition.stop();
                    let errorDetails = getTranslation('chatErrorOther'); 

                    if (event.error === 'network') {
                        errorDetails = getTranslation('chatErrorNetwork');
                    } else if (event.error === 'no-speech') {
                        updateButtonState(false, false, "chatStatusReady");
                        return; 
                    } else {
                         errorDetails = event.error;
                    }
                    
                    displayError("chatErrorVoiceInput", " " + errorDetails); 
                    updateButtonState(false, false, "chatStatusReady");
                };

                recognition.onend = () => {
                    if(isListening) {
                       updateButtonState(false, false, "chatStatusReady");
                    }
                    isListening = false;
                };

                if (voiceButton) {
                    voiceButton.disabled = false;
                    updateButtonState(false, false, "chatStatusReady");
                }
            };

            const sendMessage = async (userQuery) => {
                if (!userQuery.trim()) {
                    updateButtonState(false, false, "chatStatusReady");
                    return;
                }

                appendMessage('user', userQuery);
                updateButtonState(false, true, "chatStatusGenerating"); 

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                };

                try {
                    if (apiKey === "" || apiKey.includes("YOUR_GEMINI_API_KEY")) {
                        throw new Error(getTranslation('chatErrorNoApiKey'));
                    }

                    const response = await exponentialBackoffFetch(chatApiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    const result = await response.json();
                    const aiResponseText = result.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (aiResponseText) {
                        appendMessage('model', aiResponseText);
                        updateButtonState(false, false, "chatStatusReady");
                    } else {
                        throw new Error(getTranslation('chatErrorNoResponse'));
                    }

                } catch (error) {
                    console.error("LLM Error:", error);
                    displayError("chatErrorSendFailed", " " + error.message);
                    updateButtonState(false, false, "chatStatusReady");
                }
            };
            
            // This is the global click handler for the button
            window.handleStartRecording = () => {
                if (isListening) {
                    recognition.stop();
                    updateButtonState(false, false, "chatStatusStopped");
                } else if (!isSpeaking) { // isSpeaking is always false, so this check is fine
                    try {
                        recognition.start();
                    } catch (e) {
                        // Handle race condition where button is clicked rapidly
                        if (e.name !== 'InvalidStateError') {
                            console.error("Recognition start error:", e);
                            displayError("chatErrorRecognitionStart");
                        }
                    }
                }
            };

            // --- 6. INITIALIZATION & EVENT LISTENERS ---
            
            if (langToggleBtn) langToggleBtn.addEventListener('click', toggleLanguage);
            if (langToggleBtnMobile) langToggleBtnMobile.addEventListener('click', toggleLanguage);
            if (themeToggleBtn) themeToggleBtn.addEventListener('click', toggleTheme);
            if (themeToggleBtnMobile) themeToggleBtnMobile.addEventListener('click', toggleTheme);

            const initialTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            updateIcons(initialTheme);
            
            // Initialize chat app FIRST
            setupVoiceRecognition();

            // Set initial language LAST (to configure recognition.lang)
            const initialLang = localStorage.getItem('language') || 'bn'; 
            setLanguage(initialLang);
        });
    </script>
</body>
</html>